(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[404],{768:(e,t,r)=>{Promise.resolve().then(r.bind(r,8188))},3941:(e,t,r)=>{"use strict";r.d(t,{N:()=>s});let s=(0,r(1993).UU)("https://iohyiycjclqjxfhhewel.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvaHlpeWNqY2xxanhmaGhld2VsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1Mzk1OTEsImV4cCI6MjA3NjExNTU5MX0.mZjN4Q_0mjmNDDKe5rbzM8Ef-ThVEMQ5h9mC6oIziO8")},8188:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(5155),a=r(2115),o=r(3941);function i(){let[e,t]=(0,a.useState)([]),[r,i]=(0,a.useState)([]),[n,d]=(0,a.useState)([]),[l,c]=(0,a.useState)([]),[m,x]=(0,a.useState)(null),[h,p]=(0,a.useState)(!1);(0,a.useEffect)(()=>{g(),y()},[]);let g=async()=>{await u(),await j(),await b()},u=async()=>{try{let{data:e,error:r}=await o.N.from("projects").select("*").order("created_at",{ascending:!1});if(r)throw r;t(e||[])}catch(e){console.error("Erro ao carregar projetos:",e)}},j=async()=>{try{let{data:e,error:t}=await o.N.from("people").select("*").order("created_at",{ascending:!1});if(t)throw t;i(e||[])}catch(e){console.error("Erro ao carregar pessoas:",e)}},b=async()=>{try{let{data:e,error:t}=await o.N.from("assignments").select("*");if(t)throw t;d(e||[])}catch(e){console.error("Erro ao carregar assignments:",e)}},f=async e=>{d(e);try{for(let t of e){let{data:e}=await o.N.from("assignments").select("id").eq("person_id",t.person_id).eq("project_id",t.project_id).eq("date",t.date).single();if(e){let{error:r}=await o.N.from("assignments").update({hours:t.hours}).eq("id",e.id);if(r)throw r}else{let{error:e}=await o.N.from("assignments").insert([{person_id:t.person_id,project_id:t.project_id,date:t.date,hours:t.hours}]);if(e)throw e}}e.map(e=>e.id);let{data:t}=await o.N.from("assignments").select("id, person_id, project_id, date");if(t){for(let r of t)if(!e.some(e=>e.person_id===r.person_id&&e.project_id===r.project_id&&e.date===r.date)){let{error:e}=await o.N.from("assignments").delete().eq("id",r.id);e&&console.error("Erro ao remover assignment:",e)}}console.log("✅ Assignments sincronizados com o Supabase")}catch(e){console.error("Erro ao salvar assignments:",e),alert("Erro ao salvar aloca\xe7\xf5es. Tente novamente.")}},y=()=>{let e=new Date,t=e.getDay(),r=e.getDate(),s=new Date(e);s.setDate(r-t+(0===t?-6:1));let a=[];for(let e=0;e<5;e++){let t=new Date(s);t.setDate(s.getDate()+e),a.push(t)}c(a)},N=(e,t)=>n.filter(r=>r.person_id===e&&r.date===t).reduce((e,t)=>e+t.hours,0),v=async function(e,t,r){let s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=n.findIndex(s=>s.person_id===t&&s.project_id===e&&s.date===r);-1!==o?(s=[...n],s[o].hours+=a):s=[...n,{id:Math.random().toString(36),project_id:e,person_id:t,date:r,hours:a}],d(s),f(s)},w=async e=>{let t=n.filter(t=>t.id!==e);d(t),await f(t)},_=e=>{c(l.map(t=>{let r=new Date(t);return r.setDate(t.getDate()+("next"===e?7:-7)),r}))},D=async(e,t)=>{if(t<=0)return void await w(e);let r=n.map(r=>r.id===e?{...r,hours:t}:r);d(r),await f(r)};return(0,s.jsxs)("div",{className:"container mx-auto p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Timeline de Aloca\xe7\xf5es"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:()=>_("prev"),className:"bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600",children:"← Semana Anterior"}),(0,s.jsx)("button",{onClick:()=>_("next"),className:"bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600",children:"Pr\xf3xima Semana →"})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-700 mb-3",children:"Projetos Dispon\xedveis (Arraste para alocar):"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,s.jsxs)("div",{className:"bg-green-100 border border-green-300 rounded px-3 py-2 text-sm cursor-move hover:bg-green-200 transition-colors",draggable:!0,onDragStart:()=>{x(e.id)},children:[(0,s.jsx)("strong",{children:e.code}),": ",e.name]},e.id))})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-md overflow-auto",children:(0,s.jsxs)("table",{className:"min-w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-gray-700 bg-gray-50 border-b",children:"Pessoa / Data"}),l.map((e,t)=>(0,s.jsx)("th",{className:"px-4 py-3 text-center text-sm font-medium text-gray-700 bg-gray-50 border-b",children:e.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",weekday:"short"})},t))]})}),(0,s.jsx)("tbody",{children:r.map(t=>(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsxs)("td",{className:"px-4 py-3",children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:t.full_name}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:t.role}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:["R$ ","number"==typeof t.hourly_cost?t.hourly_cost.toFixed(2):"0.00","/h"]})]}),l.map((r,a)=>{let o=r.toISOString().split("T")[0],i=N(t.id,o),d=N(t.id,o)>8;return(0,s.jsx)("td",{className:"px-4 py-3 border-l border-gray-200 min-w-40",onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},onDrop:()=>{var e;return e=t.id,void(m&&(v(m,e,o),x(null)))},children:(0,s.jsxs)("div",{className:"p-2 rounded border-2 border-dashed border-gray-300 min-h-16 ".concat(d?"bg-red-50 border-red-200":"bg-gray-50"),children:[n.filter(e=>e.person_id===t.id&&e.date===o).map(t=>{let r=e.find(e=>e.id===t.project_id);return(0,s.jsxs)("div",{className:"bg-green-100 border border-green-300 rounded px-2 py-1 mb-1 text-sm",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{className:"font-medium text-xs",children:(e=>{if(!e)return"Projeto N\xe3o Encontrado";let t=e.name;return t.length>10&&(t=t.substring(0,10)+"..."),"".concat(e.code,": ").concat(t)})(r)}),(0,s.jsx)("button",{onClick:()=>w(t.id),className:"text-red-500 hover:text-red-700 text-xs ml-1",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,s.jsx)("input",{type:"number",min:"0",max:"24",step:"0.5",value:t.hours,onChange:e=>D(t.id,parseFloat(e.target.value)||0),className:"w-12 text-xs border rounded px-1 py-0.5"}),(0,s.jsx)("span",{className:"text-xs text-gray-600",children:"horas"})]})]},t.id)}),i>0&&(0,s.jsxs)("div",{className:"text-xs mt-1 ".concat(d?"text-red-600 font-semibold":"text-gray-500"),children:["Total: ",i,"h ",d&&" ⚠️"]})]})},a)})]},t.id))})]})}),(0,s.jsxs)("div",{className:"mt-6 bg-blue-50 p-4 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-semibold text-blue-800 mb-2",children:"Como usar:"}),(0,s.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"Arraste os projetos"})," para os dias da semana de cada pessoa"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"Ajuste as horas"})," diretamente no input de cada aloca\xe7\xe3o"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"Clique no \xd7"})," para remover uma aloca\xe7\xe3o"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"Vermelho"})," indica sobrecarga (>8h/dia)"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"Dados salvos automaticamente"})," no banco de dados"]})]})]})]})}}},e=>{e.O(0,[993,441,255,358],()=>e(e.s=768)),_N_E=e.O()}]);